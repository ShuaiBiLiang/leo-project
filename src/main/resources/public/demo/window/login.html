<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Window Border Style - jQuery EasyUI Demo</title>
	<link rel="stylesheet" type="text/css" href="../../themes/default/easyui.css">
	<link rel="stylesheet" type="text/css" href="../../themes/icon.css">
	<link rel="stylesheet" type="text/css" href="../../themes/color.css">
	<link rel="stylesheet" type="text/css" href="../demo.css">
	<script type="text/javascript" src="../../jquery.min.js"></script>
	<script type="text/javascript" src="../../jquery.easyui.min.js"></script>
	<script type="text/javascript" src="refreshPrice.js"></script>
</head>
<body>
	<h2>当前最高价:<input id="maxPrice"  type="text" name="" /> coin数目:<input id="allCoinTotal"  type="text" name="" />
		<a href="javascript:void(0)" class="easyui-linkbutton" onclick="commitAllOrder(12,'/admin/leo/commit')">全部提交</a></h2>
	<p id="commitStatus"></p>

	<div style="height:750px;border:1px solid #ddd">
		<!--<div class="easyui-window" title="Window" data-options="width:800,height:450,left:5,top:10,inline:true" style="width:850px;height:350px;padding:10px">-->
			<div class="easyui-panel" title="登录" style="width:400px;float:left;">
				<div style="padding:10px 60px 20px 60px">
					<form id="login" method="post">
						<table cellpadding="5">
							<tr><td>登录名:<input id="login_name" class="easyui-textbox" type="textarea" name="cookie"
													data-options="required:true"/></td>
							</tr>
							<tr><td>登录密码:<input id="login_pwd" class="easyui-textbox" type="textarea" name="cookie"
											   data-options="required:true"/></td>
							</tr>
							<tr><td>验证码:<input id="login_validate" class="easyui-textbox" type="textarea" name="cookie"
											   data-options="required:true"/></td>
							</tr>
						</table>
					</form>
					<div style="text-align:center;padding:5px">
						<a href="javascript:void(0)" class="easyui-linkbutton" onclick="login()">登录</a>
					</div>
				</div>
			</div>
			<div class="easyui-panel" title="价格刷新器" style="width:400px;float:left;">
				<div style="padding:10px 60px 20px 60px">
					<form id="ff" method="post">
						<table cellpadding="5">
							<tr><td>cookie信息:<input id="cookie0" name="cookie"/></td>
							</tr>
							<tr><td>coin价格:<input id="priceInput0" class="easyui-textbox" type="text" name="currentPrice"
												  data-options="required:false"/></td>
							</tr>
							<tr><td>coin数目:<input id="totalCoin0" class="easyui-textbox" type="text" name="currentPrice"
												  data-options="required:false"/></td>
							</tr>
							<input type="hidden" id="refreshFlag0" value="start"/>
						</table>
					</form>
					<div style="text-align:center;padding:5px">
						<a href="javascript:void(0)" class="easyui-linkbutton" onclick="startRefresh('0','/admin/leo/price')">启动刷新</a>
						<a href="javascript:void(0)" class="easyui-linkbutton" onclick="commitPrice('0','/admin/leo/commit')">提交订单</a>
						<a href="javascript:void(0)" class="easyui-linkbutton" onclick="stopRefresh('0')">暂停</a>
						<a href="javascript:void(0)" class="easyui-linkbutton" onclick="clearForm('0')">清空</a>
					</div>
				</div>
			</div>
			<p id="status0"></p>
			<p class="w-content" id="w0">Window content</p>

	</div>



	<script type="text/javascript">
		$('.easyui-window').window({
			collapsible: false,
			minimizable: false,
			maximizable: false,
			closable: false
		});

        function login(){

            var name = $("#login_name").val();
            var pwd = $("#login_pwd").val();
            var validate_code = $("#login_validate").val();

            var param = {userInfo:name+" "+pwd+" "+validate_code};
			var url = "/admin/leo/getCookie";
            $.ajax({
                url: url,
                data: param,
                dataType: 'json',
                success: function(data){
                    alert(data.data.msg);
                    $("#cookie0").val(data.data.msg);
                }
            });


        }

        function commitAllOrder(index ,url){
            for(var i=0; i<index;i++){
                commitPrice(i ,url);
            }

            stopRefreshAll(index);

        }

		function commitPrice(index ,url){

			var cprice = $("#priceInput"+index).val();
			if($("#maxPrice").val()){
				cprice = $("#maxPrice").val();
			}
			var tempCookie = $("#cookie"+index).val();
			var totalCoin = $("#totalCoinInput"+index).val();
			if($("#allCoinTotal").val()){
				totalCoin = $("#allCoinTotal").val();
			}
			if(totalCoin){

			}else {
				totalCoin = 50;
			}
			if(tempCookie==""||tempCookie==undefined){
				return;
			}

			var param = {cookie:tempCookie,currentPrice:cprice,totalCoin:totalCoin};

			$.ajax({
				url: url,
				data: param,
				dataType: 'json',
				success: function(data){
					$("#w"+index).prepend("<span style='border:3px solid #ffa8a8'>"+data.data.msg+"</span></br>");
				},
				error: function(data){
					$("#w"+index).prepend("<span style='border:3px solid #ffa8a8'>失败："+data.data.msg+"</span></br>");
				}
			});

		}
	</script>
	<style type="text/css" scoped="scoped">
		.w-content{
			padding:5px 10px;
		}
	</style>
</body>
</html>